(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{870:function(e,t,n){"use strict";n.r(t);var r=n(289),o=n(6),c=n(764),l=n(745),O=n(216),m=n(283),S=n(182),d=n(224),E=n(285),y=n(759),A=n(756),f=(n(9),n(8),n(12),n(13),n(1)),v=n(22),C=(n(66),n(27),n(111),n(4),n(83),n(10),n(43),n(7),n(122)),T=n(2),R=n.n(T),I=n(68),h=n.n(I);function L(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,n)}return t}function x(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?L(Object(source),!0).forEach((function(t){Object(f.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):L(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}var N={props:{search:{type:Object,required:!0}},mixins:[C.a],data:function(){return{selectedMonth:{start:R()().startOf("month").format("YYYY-MM-DD"),end:R()().endOf("month").format("YYYY-MM-DD")},paymentSnack:!1,headersExpanded:[{text:"Fecha",value:"date"},{text:"TIPO",value:"type"},{text:"MONTO",value:"amount"},{text:"COMENTARIOS",value:"comments"},{text:"",value:"id",align:"right"}],headers:[{text:"FACTURACION",value:"FACTURACION"},{text:"COMISION",value:"COMISION"},{text:"PUBLI",value:"PUBLI"},{text:"SERVER",value:"SERVER"},{text:"REEMBOLSOS",value:"REEMBOLSOS"},{text:"PAGOS CHINO",value:"PAGOS_CHINO"},{text:"AT.CLIENTE",value:"AT_CLIENTE"},{text:"ABOGADA",value:"ABOGADA"},{text:"EXTRAS",value:"EXTRAS"}],data:[{FACTURACION:0,TOTAL_GASTOS:0,COMISION:0,PUBLI:0,SERVER:0,REEMBOLSOS:0,PAGOS_CHINO:0,AT_CLIENTE:0,ABOGADA:0,EXTRAS:0}],paymentsExpandData:[],toggleFullScreen:!1}},created:function(){var e=this;this.$root.$on("refresh",(function(data){e.getPayments()}))},methods:{formatType:function(e){switch(e){case"FACTURACION":return"FACTURACION";case"COMISION":return"COMISION";case"PUBLI":return"PUBLI";case"SERVER":return"SERVER";case"REEMBOLSOS":return"REEMBOLSOS";case"PAGOS_CHINO":return"PAGOS CHINO";case"AT_CLIENTE":return"AT.CLIENTE";case"ABOGADA":return"ABOGADA";case"EXTRAS":return"EXTRAS";default:return""}},getIncomeData:function(){var e=this;return Object(v.a)(regeneratorRuntime.mark((function t(){var n,data;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.$axios.get("/webservices/payments/".concat(e.search.store),{params:x(x({},e.selectedMonth),{},{method:"month"})});case 2:return n=t.sent,data=n.data,t.abrupt("return",data);case 5:case"end":return t.stop()}}),t)})))()},getPayments:function(){var e=this;return Object(v.a)(regeneratorRuntime.mark((function t(){var n,data,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.$axios.get("/payments/",{params:{filters:{store:e.search.store,createdAt:{$gte:e.selectedMonth.start_date,$lte:e.selectedMonth.end_date}},populate:"*"},paramsSerializer:function(e){return h.a.stringify(e,{arrayFormat:"brackets"})}});case 2:return n=t.sent,data=n.data,t.next=6,e.getIncomeData();case 6:if(r=t.sent,r=Object.values(r).reduce((function(e,t){return t}),{}),0!=data.data.length){t.next=12;break}e.data=[{FACTURACION:r,COMISION:0,PUBLI:0,SERVER:0,REEMBOLSOS:0,PAGOS_CHINO:0,AT_CLIENTE:0,ABOGADA:0,EXTRAS:0,TOTAL_GASTOS:0}],t.next=16;break;case 12:return t.next=14,e.groupedByType(data.data,r);case 14:e.data=t.sent,e.paymentsExpandData=data.data;case 16:case"end":return t.stop()}}),t)})))()},groupedByType:function(e,t){return Object(v.a)(regeneratorRuntime.mark((function n(){var r,o,c;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=_.groupBy(e,"type"),o={FACTURACION:t,COMISION:0,PUBLI:0,SERVER:0,REEMBOLSOS:0,PAGOS_CHINO:0,AT_CLIENTE:0,ABOGADA:0,EXTRAS:0,TOTAL_GASTOS:0},(c=Object.values(r).reduce((function(e,t){return t.forEach((function(t){e[t.type]+=t.amount})),e}),o)).TOTAL_GASTOS=e.reduce((function(e,t){return e+t.amount}),0),n.abrupt("return",[c]);case 5:case"end":return n.stop()}}),n)})))()},groupedByTypeExpanded:function(e){return e.map((function(e){return{id:e.id,date:e.date,FACTURACION:"FACTURACION"===e.type?e.amount:0,COMISION:"COMISION"===e.type?e.amount:0,PUBLI:"PUBLI"===e.type?e.amount:0,SERVER:"SERVER"===e.type?e.amount:0,REEMBOLSOS:"REEMBOLSOS"===e.type?e.amount:0,PAGOS_CHINO:"PAGOS_CHINO"===e.type?e.amount:0,AT_CLIENTE:"AT_CLIENTE"===e.type?e.amount:0,ABOGADA:"ABOGADA"===e.type?e.amount:0,EXTRAS:"EXTRAS"===e.type?e.amount:0,TOTAL_GASTOS:e.amount}}))},deletePayment:function(e){var t=this;this.$axios.delete("/payments/".concat(e)).then((function(){t.paymentSnack=!0,t.paymentsExpandData=t.paymentsExpandData.filter((function(t){return t.id!==e})),t.$root.$emit("refresh")})).catch((function(e){console.log(e)}))}},computed:{resumeIncomes:function(){return this.data[0].FACTURACION-this.data[0].TOTAL_GASTOS}},watch:{selectedMonth:function(){this.search.store&&this.getPayments()}}},w=n(19),component=Object(w.a)(N,(function(){var e=this,t=e._self._c;return t("div",[t("GeneralCardComponent",[t("GeneralCardTitleComponent",{staticClass:"primary white--text"},[e._v("\n      Resumen\n      "),t(A.a),e._v(" "),t(r.a,{attrs:{icon:"",outlined:""},on:{click:function(t){e.toggleFullScreen=!e.toggleFullScreen}}},[e.toggleFullScreen?t(O.a,{attrs:{color:"white"}},[e._v("mdi-window-minimize")]):t(O.a,{attrs:{color:"white"}},[e._v("mdi-window-maximize")])],1)],1),e._v(" "),t(o.d,[t("formsFieldsSelectMonthComponent",{attrs:{label:"Seleccione el rango de fechas"},on:{dateUpdated:function(t){e.selectedMonth=t}}})],1),e._v(" "),t(c.a,{attrs:{headers:e.headers,items:e.data,"hide-default-footer":""},scopedSlots:e._u([{key:"item.FACTURACION",fn:function(t){var n=t.item;return[e._v("\n        "+e._s(n.FACTURACION.toLocaleString("es-ES",{style:"currency",currency:"EUR"}))+"\n      ")]}},{key:"item.COMISION",fn:function(t){var n=t.item;return[e._v("\n        "+e._s(n.COMISION.toLocaleString("es-ES",{style:"currency",currency:"EUR"}))+"\n      ")]}},{key:"item.PUBLI",fn:function(t){var n=t.item;return[e._v("\n        "+e._s(n.PUBLI.toLocaleString("es-ES",{style:"currency",currency:"EUR"}))+"\n      ")]}},{key:"item.SERVER",fn:function(t){var n=t.item;return[e._v("\n        "+e._s(n.SERVER.toLocaleString("es-ES",{style:"currency",currency:"EUR"}))+"\n      ")]}},{key:"item.REEMBOLSOS",fn:function(t){var n=t.item;return[e._v("\n        "+e._s(n.REEMBOLSOS.toLocaleString("es-ES",{style:"currency",currency:"EUR"}))+"\n      ")]}},{key:"item.PAGOS_CHINO",fn:function(t){var n=t.item;return[e._v("\n        "+e._s(n.PAGOS_CHINO.toLocaleString("es-ES",{style:"currency",currency:"EUR"}))+"\n      ")]}},{key:"item.AT_CLIENTE",fn:function(t){var n=t.item;return[e._v("\n        "+e._s(n.AT_CLIENTE.toLocaleString("es-ES",{style:"currency",currency:"EUR"}))+"\n      ")]}},{key:"item.ABOGADA",fn:function(t){var n=t.item;return[e._v("\n        "+e._s(n.ABOGADA.toLocaleString("es-ES",{style:"currency",currency:"EUR"}))+"\n      ")]}},{key:"item.EXTRAS",fn:function(t){var n=t.item;return[e._v("\n        "+e._s(n.EXTRAS.toLocaleString("es-ES",{style:"currency",currency:"EUR"}))+"\n      ")]}},{key:"item.TOTAL_GASTOS",fn:function(t){var n=t.item;return[e._v("\n        "+e._s(n.TOTAL_GASTOS.toLocaleString("es-ES",{style:"currency",currency:"EUR"}))+"\n      ")]}}])}),e._v(" "),t(o.b,{staticClass:"primary py-0"},[t(m.a,{attrs:{dense:"",color:"transparent"}},[t(S.a,[t(E.a,{attrs:{color:"secondary"}},[t(O.a,{attrs:{color:"black"}},[e._v("mdi-bank")])],1),e._v(" "),t(d.b,[t(d.c,{staticClass:"font-weight-bold white--text"},[e._v("Total")])],1),e._v(" "),t(d.a,{staticClass:"font-weight-bold text-subtitle-2 white--text"},[e._v("\n            € "+e._s(e.resumeIncomes)+"\n          ")])],1)],1)],1)],1),e._v(" "),t(l.a,{attrs:{persistent:""},model:{value:e.toggleFullScreen,callback:function(t){e.toggleFullScreen=t},expression:"toggleFullScreen"}},[t("GeneralCardComponent",[t("GeneralCardTitleComponent",{staticClass:"primary white--text"},[e._v("\n        Detalles\n        "),t(A.a),e._v(" "),t(r.a,{attrs:{icon:"",outlined:""},on:{click:function(t){e.toggleFullScreen=!e.toggleFullScreen}}},[e.toggleFullScreen?t(O.a,{attrs:{color:"white"}},[e._v("mdi-window-minimize")]):t(O.a,{attrs:{color:"white"}},[e._v("mdi-window-maximize")])],1)],1),e._v(" "),t(c.a,{attrs:{headers:e.headersExpanded,items:e.paymentsExpandData,"items-per-page":-1,"hide-default-footer":""},scopedSlots:e._u([{key:"item.type",fn:function(t){var n=t.item;return[e._v("\n          "+e._s(e.formatType(n.type))+"\n        ")]}},{key:"item.amount",fn:function(t){var n=t.item;return[e._v("\n          "+e._s(n.amount.toLocaleString("es-ES",{style:"currency",currency:"EUR"}))+"\n        ")]}},{key:"item.id",fn:function(n){var o=n.item;return[t(r.a,{staticClass:"my-3",attrs:{fab:"",small:"",rounded:"",color:"red",elevation:"3"},on:{click:function(t){return e.deletePayment(o.id)}}},[t(O.a,[e._v("mdi-delete")])],1)]}}])}),e._v(" "),t(o.b,{staticClass:"primary py-0"},[t(m.a,{attrs:{dense:"",color:"transparent"}},[t(S.a,[t(E.a,{attrs:{color:"secondary"}},[t(O.a,{attrs:{color:"black"}},[e._v("mdi-bank")])],1),e._v(" "),t(d.b,[t(d.c,{staticClass:"font-weight-bold white--text"},[e._v("Total")])],1),e._v(" "),t(d.a,{staticClass:"font-weight-bold text-subtitle-2 white--text"},[e._v("\n              € "+e._s(e.resumeIncomes)+"\n            ")])],1)],1)],1)],1)],1),e._v(" "),t(y.a,{staticClass:"black--text",attrs:{color:"success"},model:{value:e.paymentSnack,callback:function(t){e.paymentSnack=t},expression:"paymentSnack"}},[e._v("\n    Pago eliminado correctamente\n  ")])],1)}),[],!1,null,null,null);t.default=component.exports;installComponents(component,{GeneralCardTitleComponent:n(130).default,GeneralCardComponent:n(82).default})}}]);