(window.webpackJsonp=window.webpackJsonp||[]).push([[52],{933:function(e,t,r){"use strict";r.r(t);var n=r(294),o=r(284),c=r(2),d=r(770),l=r(781),m=r(287),f=r(896),h=r(225),_=r(897),v=r(769),k=r(776),y=r(895),x=r(97),C=(r(23),r(90),r(12),r(8),r(13),r(11),r(14),r(21)),O=r(1),w=(r(65),r(103),r(9),r(5),r(131)),F=r(4),D=r.n(F),j=r(799),$=r(800),P=r(808);function T(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(object);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,r)}return t}function S(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?T(Object(source),!0).forEach((function(t){Object(O.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):T(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}var Y={filters:{delivery_address:function(e){return" "!=e.address1?e.address1:e.address2}},mixins:[w.a,j.a,$.a,P.a],name:"storeCardComponent",data:function(){return{expanded:[],mode:"list",filter:"",pagination:{rowsPerPage:10},search:{page:1,state:"2"},loading:!1,copyOrderSnackbar:!1,data:{orders:[],total_pages:0,total_count:0},order:{},showOrderModal:!1,updateTrackingProduct:{}}},mounted:function(){this.search.startDate=D()().subtract(1,"month").format("YYYY-MM-DD"),this.search.endDate=D()().format("YYYY-MM-DD"),this.getAllOrders()},methods:{showOrder:function(e){this.order=e,this.showOrderModal=!0,console.log(this.order)},getAllOrders:function(){var e=this;this.loading=!0,this.$axios.get("/webservices/orderListallstores/",{params:S(S({},this.search),{},{company:this.$auth.user.company.id})}).then((function(t){e.loading=!1,console.log(e.loading),e.data=t.data})).catch((function(){e.loading=!1}))},setProduct:function(e,t){this.updateTrackingProduct={order_id:e.order.id,product_id:t.item.id}},updateTrackingOrder:function(e){var t=this;return Object(C.a)(regeneratorRuntime.mark((function r(){var data,n,o,c;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(data={product_id:e.product.id,store_id:e.storeId,order_id:e.order.id,net_price:e.product.net_price,tracking_number:e.product.tracking_number,complete_order_data:e},r.prev=1,!e.product.extra_id){r.next=7;break}return r.next=5,t.$axios.put("/orders/".concat(e.product.extra_id),{data:data});case 5:r.next=13;break;case 7:return r.next=9,t.$axios.post("/orders/",{data:data});case 9:n=r.sent,o=n.data,c=t.data.orders.findIndex((function(t){return t.id==e.id})),t.$set(t.data.orders,c,S(S({},t.data.orders[c]),{},{product:S(S({},t.data.orders[c].product),{},{extra_id:o.data.id})}));case 13:e.product.tracking_number&&e.product.tracking_number.length>6&&t.$axios.post("/orders/tracking",data),r.next=19;break;case 16:r.prev=16,r.t0=r.catch(1),console.log(r.t0);case 19:case"end":return r.stop()}}),r,null,[[1,16]])})))()}},computed:{filteredColumns:function(){return this.columns.filter((function(col){return col.visible}))}},watch:{"search.page":function(){this.getAllOrders()}}},M=r(10),component=Object(M.a)(Y,(function(){var e=this,t=e._self._c;return t("GeneralCardComponent",{staticClass:"mx-auto"},[t("generalCardTitleComponent",{staticClass:"primary white--text"},[e._v("Todos los pedidos")]),e._v(" "),t(m.a),e._v(" "),t(c.d,[t(o.a,{staticClass:"rounded-lg",attrs:{outlined:""}},[t(c.d,[t(v.a,[t(d.a,{staticClass:"col-md-11 col-12"},[t(v.a,[t(d.a,{staticClass:"col-md-2 col-12"},[t("FormsFieldsTextComponent",{attrs:{label:"Cliente"},model:{value:e.search.customer,callback:function(t){e.$set(e.search,"customer",t)},expression:"search.customer"}})],1),e._v(" "),t(d.a,{staticClass:"col-md-2 col-12"},[t("FormsFieldsTextComponent",{attrs:{label:"Producto"},model:{value:e.search.product,callback:function(t){e.$set(e.search,"product",t)},expression:"search.product"}})],1),e._v(" "),t(d.a,{staticClass:"col-md-2 col-12"},[t("FormsFieldsTextComponent",{attrs:{label:"Referencia"},model:{value:e.search.reference,callback:function(t){e.$set(e.search,"reference",t)},expression:"search.reference"}})],1),e._v(" "),t(d.a,{staticClass:"col-md-2 col-12"},[t("FormsFieldsTextComponent",{attrs:{type:"date",label:"Fecha inicio"},model:{value:e.search.startDate,callback:function(t){e.$set(e.search,"startDate",t)},expression:"search.startDate"}})],1),e._v(" "),t(d.a,{staticClass:"col-md-2 col-12"},[t("FormsFieldsTextComponent",{attrs:{type:"date",label:"Fecha fin"},model:{value:e.search.endDate,callback:function(t){e.$set(e.search,"endDate",t)},expression:"search.endDate"}})],1),e._v(" "),t(d.a,{staticClass:"col-md-2 col-12"},[t("FormsFieldsSelectComponent",{attrs:{items:e.stateItems,label:"Estado"},model:{value:e.search.state,callback:function(t){e.$set(e.search,"state",t)},expression:"search.state"}})],1)],1)],1),e._v(" "),t(d.a,{staticClass:"col-md-1 col-12 d-flex justify-center align-center"},[t(n.a,{staticClass:"primary white--text mt-4",attrs:{fab:""},on:{click:function(t){return e.getAllOrders()}}},[t(h.a,[e._v("mdi-filter")])],1)],1)],1)],1)],1)],1),e._v(" "),t(c.d,[t(o.a,{attrs:{outlined:""}},[t(v.a,{attrs:{"no-gutters":""}},e._l(e.columns,(function(col){return t(y.a,{key:col.value,staticClass:"mr-2 my-2",attrs:{label:col.text},model:{value:col.visible,callback:function(t){e.$set(col,"visible",t)},expression:"col.visible"}})})),1)],1)],1),e._v(" "),t(c.c,[t(l.a,{attrs:{"item-key":"id","show-expand":"","single-expand":"",loading:e.loading,"loading-text":"Cargando ordenes","disable-pagination":"","disable-sort":"","calculate-widths":"","disable-filtering":"",items:e.data.orders,headers:e.filteredColumns,"hide-default-footer":"","items-per-page":10},scopedSlots:e._u([{key:"item.creation_date",fn:function(t){var r=t.item;return[e._v("\n        "+e._s(e._f("formatDate")(r.creation_date))+"\n      ")]}},{key:"item.cost",fn:function(t){var r=t.item;return[e._v("\n        € "+e._s(r.cost)+"\n      ")]}},{key:"item.delivery_address.address1",fn:function(t){var r=t.item;return[e._v("\n         "+e._s(e._f("delivery_address")(r.delivery_address))+"\n      ")]}},{key:"item.profit",fn:function(t){var r=t.item;return[e._v("\n         "+e._s(e.calcProfit(r))+"\n      ")]}},{key:"item.order.status",fn:function(e){var r=e.item;return[t("storeChipsStatusComponent",{attrs:{status:r.order.status}})]}},{key:"item.product.tracking_number",fn:function(r){var n=r.item;return[t(f.a,{attrs:{"save-text":"Guardar","cancel-text":"Guardar"},on:{close:function(t){return e.updateTrackingOrder(n)}},scopedSlots:e._u([{key:"input",fn:function(){return[t(x.a,{attrs:{label:"Edit"},model:{value:n.product.tracking_number,callback:function(t){e.$set(n.product,"tracking_number",t)},expression:"item.product.tracking_number"}})]},proxy:!0}],null,!0)},[t(x.a,{attrs:{"hide-details":"",outlined:"",dense:"",height:"20",readonly:"",value:e.setValue("#",n.product.tracking_number)}})],1)]}},{key:"item.product.net_price",fn:function(r){var n=r.item;return[t(f.a,{on:{close:function(t){return e.updateTrackingOrder(n)}},scopedSlots:e._u([{key:"input",fn:function(){return[t(x.a,{attrs:{label:"Edit",counter:""},model:{value:n.product.net_price,callback:function(t){e.$set(n.product,"net_price",t)},expression:"item.product.net_price"}})]},proxy:!0}],null,!0)},[t(x.a,{attrs:{"hide-details":"",outlined:"",dense:"",height:"20",readonly:"",value:e.setValue("€",n.product.net_price)}})],1)]}},{key:"item.product.image_url",fn:function(e){var r=e.item;return[t("img",{attrs:{src:r.product.image_url,width:"100%",height:"80"}})]}},{key:"item.copy",fn:function(r){var o=r.item;return[t(n.a,{attrs:{rounded:"",color:"primary"},on:{click:function(t){return e.copyToClipboard(o)}}},[t(h.a,[e._v("mdi-content-copy")])],1)]}},{key:"expanded-item",fn:function(r){var n=r.headers,o=r.item;return[t("td",{staticClass:"pa-4",attrs:{colspan:n.length}},[t("ordersIncidencesComponent",{attrs:{store:o.storeId,order:o},on:{refresh:function(t){return e.getAllOrders()}}})],1)]}}])})],1),e._v(" "),t(c.a,{staticClass:"d-flex justify-center"},[t(_.a,{attrs:{length:e.data.total_pages,circle:""},model:{value:e.search.page,callback:function(t){e.$set(e.search,"page",t)},expression:"search.page"}})],1),e._v(" "),t(k.a,{model:{value:e.copyOrderSnackbar,callback:function(t){e.copyOrderSnackbar=t},expression:"copyOrderSnackbar"}},[e._v("Success to copy!")])],1)}),[],!1,null,null,null);t.default=component.exports;installComponents(component,{FormsFieldsTextComponent:r(67).default,FormsFieldsSelectComponent:r(91).default,GeneralCardComponent:r(51).default})}}]);